<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fanompoana</title>
    <style>
        /* WEB VIEW STYLES */
        body { font-family: 'Segoe UI', Arial, sans-serif; background: #f0f2f5; margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        
        .print-btn { background: #27ae60; color: white; border: none; padding: 12px 25px; border-radius: 8px; cursor: pointer; font-weight: bold; margin-bottom: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: 0.2s; }
        .print-btn:hover { background: #219150; transform: translateY(-2px); }

        .container { background: white; padding: 40px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); width: 100%; max-width: 850px; }
        
        /* Centering the Header Flex */
        .header-flex { display: flex; flex-direction: column; align-items: center; text-align: center; border-bottom: 3px solid #3498db; padding-bottom: 15px; margin-bottom: 25px; }
        h2 { color: #2c3e50; margin: 0 0 5px 0; font-size: 1.8rem; text-transform: uppercase; }
        #timestamp { font-size: 0.9rem; color: #7f8c8d; font-style: italic; }

        table { width: 100%; border-collapse: collapse; }
        th { background: #2c3e50 !important; color: white !important; padding: 15px; font-size: 0.95rem; -webkit-print-color-adjust: exact; }
        td { padding: 12px; border-bottom: 1px solid #eee; text-align: center; font-size: 1rem; color: #34495e; }
        
        /* Task column styling */
        .task-name { font-weight: bold; text-align: left; background: #f8f9fa !important; color: #2c3e50; width: 25%; -webkit-print-color-adjust: exact; }

        /* PRINT STYLES */
        @media print {
            @page { size: portrait; margin: 1cm; }
            body { background: white; padding: 0; }
            .print-btn { display: none; }
            .container { box-shadow: none; border: none; width: 100%; max-width: 100%; padding: 0; }
            
            /* Force Background Colors in Print */
            th { background-color: #2c3e50 !important; color: white !important; print-color-adjust: exact; -webkit-print-color-adjust: exact; }
            .task-name { background-color: #f8f9fa !important; print-color-adjust: exact; -webkit-print-color-adjust: exact; }
            
            h2 { color: #2c3e50 !important; }
        }
    </style>
</head>
<body>

    <button class="print-btn" onclick="window.print()">ðŸ“¥ TÃ©lÃ©charger / Imprimer le Planning</button>

    <div class="container">
        <div class="header-flex">
            <h2>Anjara Fanompoana Isan-tsabata</h2>
            <div id="timestamp">Chargement du calendrier...</div>
        </div>

        <table id="scheduleTable">
            </table>
    </div>

    <script>
        // Use your specific Query URL here
        const CSV_URL = "https://docs.google.com/spreadsheets/d/1YA0q-J7ArOKkcRS0sz6-2DMz6Hwe18emmJpR2nyyGME/gviz/tq?tqx=out:csv&sheet=Dashboard";

        async function loadSchedule() {
            try {
                const response = await fetch(CSV_URL);
                const data = await response.text();
                const rows = data.split("\n").map(row => row.split(","));
                
                let tableHTML = "";
                let timestampText = "Mise Ã  jour non disponible";

                rows.forEach((row, index) => {
                    if (row.length < 2) return;
                    
                    let firstCell = row[0].replace(/"/g, '').trim();
                    
                    if (firstCell.includes("Mis Ã  jour le")) {
                        timestampText = firstCell;
                        return; 
                    }

                    tableHTML += "<tr>";
                    row.forEach((cell, i) => {
                        const tag = index === 0 ? "th" : "td";
                        const className = i === 0 ? "task-name" : "";
                        let cleanCell = cell.replace(/"/g, '').trim();
                        tableHTML += `<${tag} class="${className}">${cleanCell}</${tag}>`;
                    });
                    tableHTML += "</tr>";
                });

                document.getElementById("scheduleTable").innerHTML = tableHTML;
                document.getElementById("timestamp").innerText = timestampText;
            } catch (error) {
                document.getElementById("timestamp").innerText = "Erreur de chargement";
            }
        }
        loadSchedule();
    </script>
</body>
</html>
